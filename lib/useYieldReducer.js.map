{"version":3,"sources":["../src/useYieldReducer.mjs"],"names":["copy","val","includes","Array","Object","Error","useYieldReducer","stateChanger","deps","initialState","state","run","dispatchCount","setDispatchCount","action","undefined","memoizedStateChanger","dispatch","newAction","current","c","abortController","abort"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;AAQA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,SAASA,IAAT,CAAeC,GAAf,EAAoB;AAClB,MAAIA,GAAG,KAAK,IAAZ,EAAkB,OAAO,IAAP;AAClB,MAAI,CAAC,SAAD,EAAY,QAAZ,EAAsB,QAAtB,EAAgC,WAAhC,EAA6CC,QAA7C,SAA6DD,GAA7D,EAAJ,EAAuE,OAAOA,GAAP;;AACvE,MAAI,QAAOA,GAAP,MAAe,QAAnB,EAA6B;AAC3B,QAAIA,GAAG,YAAYE,KAAnB,EAA0B,0BAAWF,GAAX;AAC1B,QAAIA,GAAG,YAAYG,MAAnB,EAA2B,yBAAYH,GAAZ;AAC5B;;AACD,QAAM,IAAII,KAAJ,kEAAmEJ,GAAnE,GAAN;AACD;;AAEc,SAASK,eAAT,CAA0BC,YAA1B,EAAwCC,IAAxC,EAA8CC,YAA9C,EAA4D;AACzE,kBAAqB,2BAASA,YAAT,CAArB;AAAA;AAAA,MAAOC,KAAP;AAAA,MAAcC,GAAd;;AACA,kBAA0C,qBAAS,CAAT,CAA1C;AAAA;AAAA,MAAOC,aAAP;AAAA,MAAsBC,gBAAtB,iBAFyE,CAGzE;AACA;AACA;AACA;AACA;;;AACA,MAAMC,MAAM,GAAG,mBAAOC,SAAP,CAAf,CARyE,CAUzE;AACA;AACA;;AACA,MAAMC,oBAAoB,GAAG,wBAAYT,YAAZ,EAA0BC,IAA1B,CAA7B;AAEA,MAAMS,QAAQ,GAAG,wBAAY,UAAAC,SAAS,EAAI;AACxCJ,IAAAA,MAAM,CAACK,OAAP,GAAiBD,SAAjB;AACAL,IAAAA,gBAAgB,CAAC,UAAAO,CAAC;AAAA,aAAIA,CAAC,GAAG,CAAR;AAAA,KAAF,CAAhB;AACD,GAHgB,EAGd,EAHc,CAAjB;AAKA,wBAAU,YAAM;AACd,QAAMC,eAAe,GAAGV,GAAG,CAACK,oBAAD,EAAuB;AAAEF,MAAAA,MAAM,EAAEd,IAAI,CAACc,MAAM,CAACK,OAAR;AAAd,KAAvB,CAA3B,CADc,CAEd;AACA;;AACAL,IAAAA,MAAM,CAACK,OAAP,GAAiBJ,SAAjB;AACA,WAAO;AAAA,aAAMM,eAAN,aAAMA,eAAN,uBAAMA,eAAe,CAAEC,KAAjB,EAAN;AAAA,KAAP;AACD,GAND,EAMG,CAACX,GAAD,EAAMK,oBAAN,EAA4BJ,aAA5B,CANH;AAQA,SAAO,CAACF,KAAD,EAAQO,QAAR,CAAP;AACD","sourcesContent":["// react is a peer dep\n/* eslint-disable import/no-unresolved */\nimport {\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from 'react'\n/* eslint-enable import/no-unresolved */\n\nimport useYield from './useYield'\n\nfunction copy (val) {\n  if (val === null) return null\n  if (['boolean', 'string', 'number', 'undefined'].includes(typeof val)) return val\n  if (typeof val === 'object') {\n    if (val instanceof Array) return [...val]\n    if (val instanceof Object) return { ...val }\n  }\n  throw new Error(`useYieldReducer can't use this type of action: ${typeof val}`)\n}\n\nexport default function useYieldReducer (stateChanger, deps, initialState) {\n  const [state, run] = useYield(initialState)\n  const [dispatchCount, setDispatchCount] = useState(0)\n  // action's default state is explicitly \"undefined\" so that in stateChanger we could set the\n  // action as default parameter:\n  // async function * changeState (getState, signal, action = { type: null }) {...\n  // if it equals null - parameter returns as defined and the defaulting doesn't work\n  // eslint-disable-next-line no-undefined\n  const action = useRef(undefined)\n\n  // this is the only place when we need to disable a rule, bc this is basically a\n  // useEffect wrapper: stateChanger is evaluated on external deps change\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const memoizedStateChanger = useCallback(stateChanger, deps)\n\n  const dispatch = useCallback(newAction => {\n    action.current = newAction\n    setDispatchCount(c => c + 1)\n  }, [])\n\n  useEffect(() => {\n    const abortController = run(memoizedStateChanger, { action: copy(action.current) })\n    // soft reset of the action\n    // eslint-disable-next-line no-undefined\n    action.current = undefined\n    return () => abortController?.abort()\n  }, [run, memoizedStateChanger, dispatchCount])\n\n  return [state, dispatch]\n}\n"],"file":"useYieldReducer.js"}